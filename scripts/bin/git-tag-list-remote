#!/usr/bin/env ruby
require_relative '../etc/git-helper/git-helper'
# Display the list of current remote tags
# Usage :
# $ git-tag-list-remote {remote}
# v1.1.2  9242a33  Version 1.1.2
# v1.1.3  7548e9a  Version 1.1.3
# v1.1.4  87967bb  Version 1.1.4

Tag = Struct.new(:tag, :hash)
class TagListRemote
  include GitHelper

  def tag_list
    output = %x[git ls-remote --tags 2>/dev/null | awk '{print $2, $1}' | sort -V]
    tags = []
    output.each_line do |line|
      tag, hash = line.match(/^refs\/tags\/(.*) (.{7}).*\n$/).captures
      tags << Tag.new(tag, hash)
    end
    return tags
  end

  def run
    tag_list.each do |tag|
      tag_name = colorize(tag[:tag].ljust(8), color(:tag))
      hash = colorize(tag[:hash], color(:hash))
      puts "#{tag_name}  #{hash}"
    end
  end

end
TagListRemote.new().run()
