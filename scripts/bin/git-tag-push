#!/usr/bin/env ruby
require_relative '../etc/git-helper/git-helper'
# Wrapper for pushing tags to remote
#
# Usage :
# $ git-tag-push (origin) (all tags)
# $ git-tag-push remote (all tags)
# $ git-tag-push (origin) tag
# $ git-tag-push remote tag

class GitTagPush
  include GitHelper

  def initialize(*args)
    @flags = get_flag_args(args)
    @args = get_real_args(args)
    @push_all_tags = false

    # If no options specified, we upload all tags
    if @args.size == 0
      @push_all_tags = true
    end

    elements = guess_elements(@args)
    @remoteName = elements[:remote]
    @tagName = elements[:tag]

    # Only one argument, this is either the remote or tag
    if @args.size == 1
      if is_remote @args[0]
        @push_all_tags = true
      else
        @tagName = @args[0]
      end
    end

  end

  def push_all_tags
    system("git push --no-verify --tags #{@remoteName}")
  end

  def push_specific_tag
    system("git push --no-verify #{@remoteName} #{@tagName}")
  end

  def run
    if @push_all_tags
      push_all_tags
    else
      push_specific_tag
    end
  end
end
GitTagPush.new(*ARGV).run()
