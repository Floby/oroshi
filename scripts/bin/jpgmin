#!/usr/bin/env zsh
# convert a jpg to the optimal version

local fullpath
local dssimpath

for file in $@; do
	if [[ ! -r $file ]];then
		echo "✘ $file not found!"
		continue
	fi

  if [[ ${file:e} != 'jpg' ]]; then
    echo "✘ ${file:t} is not a jpg file"
    continue
  fi

  fullpath=${file:a}
  dssimpath=${fullpath:r}_dssim.jpg

  if ! cjpeg-dssim jpegoptim $fullpath; then
    echo "✘ unable to convert ${fullpath:t}"
    continue
  fi

  mv -f $dssimpath $fullpath
  echo "✔ converted ${fullpath:t}"
done
