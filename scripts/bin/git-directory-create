#!/usr/bin/env zsh
# Init a new git directory and set the default remote to a github repo

# Default name is name of current dir
local repoName=${PWD:t:l}
local host=$1

if git init --quiet; then
  echo "✔ Init new repo"
else
  echo "✘ Unable to create repo"
  exit 1
fi

if [[ $host == 'bitbucket' || $host == 'bb' ]]; then
	git remote add origin ssh://git@bitbucket.org/pixelastic/${repoName}.git
	echo "✔ Create origin remote on bitbucket"
fi
if [[ $host == 'heroku' || $host == 'h' ]]; then
	git remote add origin git@heroku.com:${repoName}.git
	echo "✔ Create origin remote on heroku"
fi
if [[ $host == 'github' || $host == 'gh' || $host == '' ]]; then
	git remote add origin git@github.com:pixelastic/${repoName}
	echo "✔ Create origin remote on git"
fi

if git checkout --quiet -b master; then
  echo "✔ Create master branch"
else
  echo "✘ Unable to create master branch"
  exit 1
fi

if cp ~/.oroshi/config/git/gitignore .gitignore; then
  echo "✔ Add default .gitignore"
else
  echo "✘ Unable to copy .gitignore"
  exit 1
fi

if git add . && git commit --quiet -m "Initial commit."; then
  echo "✔ Initial commit"
else
  echo "✘ Unable to do the initial commit"
  exit 1
fi

if git branch develop; then
  echo "✔ Create develop branch"
else
  echo "✘ Unable to create develop branch"
  exit 1
fi

echo "✔ New git repo created!"
