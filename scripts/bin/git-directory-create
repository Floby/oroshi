#!/usr/bin/env zsh
# Init a new git directory and set the default remote to a github repo
# Usage :
# $ git-directory-create
# $ git-directory-create ./path/to/repo

local repoPath=$1

# If no path passed, we revert to the current directory
if [[ $repoPath = '' ]]; then
  repoPath=.
fi
repoPath=${repoPath:a}

# Repo short name is the path last directory
local repoName=${repoPath:t}

# Create the repo on the specified path
if git init "$repoPath" --quiet; then
  cd "$repoPath"
  echo "✔ Init $repoName repo"
else
  echo "✘ Unable to create $repoNam repo"
  exit 1
fi

# Default to a remote on github
if git remote add origin git@github.com:pixelastic/${repoName}; then
	echo "✔ Create origin remote on github"
fi

# Create master branch
if git checkout --quiet -b master; then
  echo "✔ Create master branch"
else
  echo "✘ Unable to create master branch"
  exit 1
fi

if cp ~/.oroshi/config/git/gitignore .gitignore; then
  echo "✔ Add default .gitignore"
else
  echo "✘ Unable to copy .gitignore"
  exit 1
fi

if git add . && git commit --quiet -m "Add ignore file."; then
  echo "✔ Initial commit"
else
  echo "✘ Unable to do the initial commit"
  exit 1
fi

echo "✔ New git repo created!"
